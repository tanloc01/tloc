-- NotificationModule
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Tạo GUI container một lần duy nhất
local gui = Instance.new("ScreenGui")
gui.Name = "BFNotificationGui"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local NotificationModule = {}
local currentFrame -- lưu khung thông báo hiện tại

function NotificationModule.ShowNotification(titleText, subText)
    -- Nếu đã có khung, chỉ update text
    if currentFrame and currentFrame.Parent then
        local title = currentFrame:FindFirstChild("TitleLabel")
        local sub = currentFrame:FindFirstChild("SubLabel")
        if title then title.Text = titleText end
        if sub then sub.Text = subText or "" end
        return currentFrame
    end

    -- Khung chính
    local frame = Instance.new("Frame")
    frame.Size = UDim2.fromOffset(560, 90)
    frame.AnchorPoint = Vector2.new(0.5, 0)
    frame.Position = UDim2.new(0.5, 0, 0.08, 0)
    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    frame.BackgroundTransparency = 0.4
    frame.Parent = gui
    currentFrame = frame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = frame

    local ledGradient = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 150)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 200, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 150))
    })

    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 3
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = frame

    local grad = Instance.new("UIGradient")
    grad.Color = ledGradient
    grad.Rotation = 0
    grad.Parent = stroke

    -- Logo
    local logo = Instance.new("ImageLabel")
    logo.Size = UDim2.new(0, 70, 0, 70)
    logo.Position = UDim2.new(0, 8, 0.5, 0)
    logo.AnchorPoint = Vector2.new(0, 0.5)
    logo.BackgroundTransparency = 1
    logo.Image = "rbxassetid://81935662660925"
    logo.Parent = frame

    -- Divider
    local divider = Instance.new("Frame")
    divider.Size = UDim2.new(0, 3, 1, -20)
    divider.Position = UDim2.new(0, 80, 0, 10)
    divider.BackgroundTransparency = 1
    divider.Parent = frame

    local dStroke = Instance.new("UIStroke")
    dStroke.Thickness = 3
    dStroke.Parent = divider

    local dGrad = Instance.new("UIGradient")
    dGrad.Color = ledGradient
    dGrad.Rotation = 90
    dGrad.Parent = dStroke

    -- Title
    local title = Instance.new("TextLabel")
    title.Name = "TitleLabel"
    title.Size = UDim2.new(1, -70, 0.5, 0)
    title.Position = UDim2.new(0, 190, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = titleText
    title.Font = Enum.Font.GothamBold
    title.TextScaled = true
    title.TextColor3 = Color3.fromRGB(255, 221, 0)
    title.TextStrokeTransparency = 0.5
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = frame

    -- Sub
    local sub = Instance.new("TextLabel")
    sub.Name = "SubLabel"
    sub.Size = UDim2.new(1, -100, 0.5, 0)
    sub.Position = UDim2.new(0, 100, 0.5, 0)
    sub.BackgroundTransparency = 1
    sub.Text = subText or ""
    sub.Font = Enum.Font.GothamBold
    sub.TextScaled = true
    sub.TextColor3 = Color3.fromRGB(255, 255, 255)
    sub.TextStrokeTransparency = 0.5
    sub.TextXAlignment = Enum.TextXAlignment.Left
    sub.Parent = frame

    -- Animate LED
    task.spawn(function()
        while frame.Parent do
            for i = 0, 360, 1 do
                grad.Rotation = i
                dGrad.Rotation = i
                task.wait(0.03)
            end
        end
    end)

    return frame
end

return NotificationModule
